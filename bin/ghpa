#!/usr/bin/env node

const { exec, execStream, chalk } = require('../lib/helpers');

async function main() {
  try {
    console.log(chalk.blue('üöÄ Creating PR with auto-merge...'));
    
    // Use ghp to handle commit/push/PR creation
    const ghpPath = require.resolve('./ghp');
    const ghpResult = await execStream(`node "${ghpPath}"`, { throwOnError: false });
    if (!ghpResult) {
      process.exit(1);
    }

    // Enable auto-merge
    console.log(chalk.yellow('‚è≥ Enabling auto-merge...'));
    try {
      await exec('gh pr merge --auto --squash');
      console.log(chalk.green('‚úì Auto-merge enabled'));
    } catch (error) {
      console.log(chalk.yellow('‚ö†Ô∏è  Could not enable auto-merge (may already be enabled or checks pending)'));
    }
  } catch (error) {
    console.error(chalk.red(`Error: ${error.message}`));
    process.exit(1);
  }
}

main();
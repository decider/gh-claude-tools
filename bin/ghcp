#!/usr/bin/env node

const { 
  getCurrentBranch,
  ensureBranchPushed,
  getCurrentPR,
  execStream,
  chalk 
} = require('../lib/helpers');

async function main() {
  try {
    console.log(chalk.blue('ðŸš€ Starting commit and push workflow...'));
    
    // Commit
    const ghcPath = require.resolve('./ghc');
    const ghcResult = await execStream(`node "${ghcPath}"`, { throwOnError: false });
    if (!ghcResult) {
      process.exit(1);
    }

    // Push
    const branch = await getCurrentBranch();
    try {
      await ensureBranchPushed();
      console.log(chalk.green(`âœ“ Pushed to origin/${branch}`));
    } catch (error) {
      console.log(chalk.red('âœ— Push failed'));
      process.exit(1);
    }

    // Show PR status
    const prUrl = await getCurrentPR();
    if (prUrl) {
      console.log(chalk.blue(`ðŸ“Ž PR: ${prUrl}`));
    } else {
      console.log(chalk.yellow('ðŸ’¡ No PR yet. Run \'ghp\' to create one.'));
    }
  } catch (error) {
    console.error(chalk.red(`Error: ${error.message}`));
    process.exit(1);
  }
}

main();